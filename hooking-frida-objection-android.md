# Hooking with Frida and Objection on Android
## Install and Configure Frida and Objection
-> Install client (frida 15.2.2)  
```
pip install frida-tools==11.0.0
```
-> Set frida's Scripts folder path in environment variables  
-> Test viewing the version  
```
frida --version
```

-> Install Objection  
```
pip install objection
```

### Setting Up Frida
-> Download frida-server android  

### Step 1: Check Your Device or Emulator Architecture

Run the following command to determine the architecture of your device or emulator:

```bash
adb shell getprop ro.product.cpu.abi
```

#### Example Output on a Real Device:
For most modern physical devices, the output will look like this:

```plaintext
arm64-v8a
```

![Device Architecture Example](https://github.com/user-attachments/assets/46bc7161-2f10-44e5-b5ba-6f31b3f9ddd0)

---

### Step 2: Download the Appropriate `frida-server`

Go to the [Frida releases page](https://github.com/frida/frida/releases) and download the version that matches your device's architecture.

![Frida Releases Example](https://user-images.githubusercontent.com/54555784/224460680-08d1030b-4043-44bf-8a0e-6e2ee5a92531.png)

#### Recommendations:
- For **physical devices** with `arm64-v8a` architecture, download:  
  **`frida-server-15.2.2-android-arm64.xz`**
  
- For **emulators** with `x86_64` architecture, download:  
  **`frida-server-15.2.2-android-x86_64.xz`**

-> sending frida-server to the device
```
adb push frida-server /data/local/tmp/frida-server
```

-> giving permission 755 to frida-server
```
adb shell chmod 755 /data/local/tmp/frida-server
```
-> Running frida-server and putting it in the background
```
adb shell /data/local/tmp/frida-server &
```

-> Validate that it is working
```
frida-ps -Uai
```

## Frida Tricks
-> Listing by PIDâ€™s, names and names of applications installed on the device. It is also widely used to test the connection between the frida client and the frida server.
```
frida-ps -Uai
```

-> To use a script in Frida it is necessary to receive it through the -l parameter and pass the name of the application package in the -f parameter
```
frida -U -l <frida_script> -f <package_name>
```

There have been changes regarding the use of --no-pause, in the past it was possible to use it to not pause the application process and execute the script directly, because by default when using frida, the application was paused to wait for new instructions.
Currently, --no-pause has been removed and --pause has been implemented, which basically pauses the process when starting and allows you to decide when to resume, using the %resume command, so now when starting hooking with frida, the application by default does not is paused, if the --pause parameter is not set.

-> Usage Example
```
frida -U -l <frida_script> -f <package_name> --pause
```
```
%resume
```

With frida-trace you can obtain information about the internal flow of the application, which will help in understanding the app's logic, as well as in the possible identification of vulnerabilities

-> Track all functions that have the string "log" in their name
```
frida-trace -U -f <package_name> -i "*log*"
```

-> or if you prefer, first open the application on your device and then use the following command:
```
frida-trace -U <app_name> -i "*log*"
```

## Objection Tricks
You can use objection in phases or you can pass the command directly on one line using the -s parameter, examples:
-> Mode of Use 1
```
objection -g <package_name> explore
```
```
<command>
```

-> Mode of Use 2
```
objection -g <package_name> explore -s "<command>"
```

-> Download file from device
```
file download <remote_path> <local_path>
```

-> Upload file to device
```
file upload <local_path> <remote_path>
```

-> Import Frida Script
```
import <frida_script>
```

-> Show application environment variables (cacheDrectory, codeCacheDirectory, externalCacheDirectory, filesDirectory, obbDir, packageCodePath)
```
env
```

-> List activities
```
objection -g <package_name> explore -s "android hooking list activities"
```

-> Listing services
```
objection -g <package_name> explore -s "android hooking list services"
```

-> Listing Broadcast Receivers
```
objection -g <package_name> explore -s "android hooking list receivers"
```

-> Get current activity
```
android hooking get current_activity
```

-> Launch activity
```
android intent launch_activity <package_name>.<activity>
```

-> Listing all classes
```
android hooking list classes
```

-> Listing classes from a specific package/library
```
android hooking search classes <package_name>
```

-> See methods called by the application from the MainActivity class
```
android hooking search methods <package_name> MainActivity
```

-> Generate script for hooking
```
android hooking generate simple <package_name>.<activity_name>
```

### Patching apk - Objection (Android non rooted)
-> Decompile the apk file, modify the code to add the frida gadget, repackage the modified code and sign it  
```
objection patchapk -s <app.apk>
```
or  
```
cat /proc/version
cat /proc/cpuinfo
```

-> Patch an apk with the frida-gadget.so   
```
objection patchapk -s <app.apk> -a arm64-v8a
```

## Frida Scripts for Enumeration
```
frida -U -l <frida_script> -f <package_name>
```
-> https://github.com/interference-security/frida-scripts/tree/master/android
